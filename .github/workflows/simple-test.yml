name: Test Claude Code Systemâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚Â >Â                                                                                                                                                                                                                                         â”‚
  on:â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
    workflow_dispatch:shift+tab to cycle)
      inputs:
        task:
          description: 'æµ‹è¯•ä»»åŠ¡'
          required: true
          default: 'åˆ›å»ºä¸€ä¸ªå¤æ‚çš„å¤šæ–‡ä»¶ Python é¡¹ç›®ï¼ŒåŒ…å«ç±»ã€æ–¹æ³•ã€å¼‚å¸¸å¤„ç†ï¼Œç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•ï¼Œç”Ÿæˆè¯¦ç»†çš„æ–‡æ¡£'

  jobs:
    test-claude:
      runs-on: ubuntu-latest

      steps:
        - name: æ£€æŸ¥é…ç½®
          env:
            ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
            GMAIL_USER: ${{ secrets.GMAIL_USER }}
            GMAIL_PASS: ${{ secrets.GMAIL_PASS }}
          run: |
            echo "ğŸ” æ£€æŸ¥é…ç½®..."
            if [ -z "$ANTHROPIC_API_KEY" ]; then
              echo "âŒ ANTHROPIC_API_KEY æœªé…ç½®"
              exit 1
            fi
            if [ -z "$GMAIL_USER" ]; then
              echo "âŒ GMAIL_USER æœªé…ç½®"
              exit 1
            fi
            if [ -z "$GMAIL_PASS" ]; then
              echo "âŒ GMAIL_PASS æœªé…ç½®"
              exit 1
            fi
            echo "âœ… æ‰€æœ‰é…ç½®æ£€æŸ¥é€šè¿‡"

        - name: å®‰è£… Claude Code
          run: |
            echo "ğŸ“¦ å®‰è£… Claude Code..."
            npm install -g @anthropics/claude-code
            claude-code --version

        - name: æ‰§è¡Œ Claude Code
          env:
            ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          run: |
            echo "ğŸš€ å¼€å§‹æ‰§è¡Œ Claude Code..."
            echo "ä»»åŠ¡: ${{ github.event.inputs.task }}"

            mkdir -p test-workspace
            cd test-workspace

            claude-code \
              --dangerously-skip-permissions \
              --model claude-opus-4-1-20250805 \
              --max-turns 50 \
              --task "${{ github.event.inputs.task }}" \
              --verbose

        - name: å‘é€æˆåŠŸé‚®ä»¶
          if: success()
          run: |
            npm install nodemailer
            node -e "
            const nodemailer = require('nodemailer');
            const transporter = nodemailer.createTransporter({
              host: 'smtp.qq.com',
              port: 587,
              auth: {
                user: '${{ secrets.SMTP_USER }}',
                pass: '${{ secrets.SMTP_PASS }}'
              }
            });
            transporter.sendMail({
              from: '${{ secrets.SMTP_USER }}',
              to: 'czus@qq.com',
              subject: 'ğŸ‰ Claude Code æµ‹è¯•æˆåŠŸï¼',
              html: '<h2>ç³»ç»Ÿæµ‹è¯•æˆåŠŸï¼</h2><p>âœ… Opus 4.1 æ¨¡å‹</p><p>âœ… 50è½®å¯¹è¯</p><p>âœ… æœ€å¤§æƒé™æ¨¡å¼</p><p>æ‚¨çš„ Claude Code é‚®ä»¶ç³»ç»Ÿå·²æ­£å¸¸å·¥ä½œï¼</p>'
            }).then(() => console.log('é‚®ä»¶å‘é€æˆåŠŸ'));
            "
